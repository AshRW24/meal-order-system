# Task 13 - 购物车功能测试

## 测试范围

1. ✅ 用户登录
2. ✅ 获取在售菜品列表
3. ✅ 添加菜品到购物车
4. ✅ 查询购物车列表
5. ✅ 清空购物车
6. ✅ 验证购物车已清空
7. ✅ 测试重复添加商品（数量累加）

## 运行测试

### 前置条件

1. 后端服务已启动 (http://localhost:8080)
2. 前端服务已启动 (http://localhost:5174)
3. 数据库已初始化
4. 至少有一个测试用户: `user001` / `123456`
5. 至少有一道在售菜品

### 执行测试

```bash
# 进入测试目录
cd tests/13_shopping_cart

# 运行测试
python test_cart.py
```

## 预期输出

```
============================================================
Task 13 - 购物车功能自动化测试
============================================================

=== 测试 1: 用户登录 ===
✅ 登录成功 - 用户ID: 1

=== 测试 2: 获取在售菜品 ===
✅ 获取成功 - 共 8 道菜品

=== 测试 3: 添加菜品到购物车 (ID: 1) ===
✅ 添加成功

=== 测试 4: 查询购物车列表 ===
✅ 查询成功 - 购物车有 1 件商品
   - 宫保鸡丁 x2 = ¥56.00

=== 测试 5: 清空购物车 ===
✅ 清空成功

=== 测试 6: 验证购物车已清空 ===
✅ 验证成功 - 购物车已清空

=== 测试 7: 添加重复商品 (ID: 1) ===
✅ 测试成功 - 重复添加商品，数量增加到 2

============================================================
测试总结
============================================================
✅ PASS - 用户登录
✅ PASS - 获取在售菜品
✅ PASS - 添加到购物车
✅ PASS - 查询购物车列表
✅ PASS - 清空购物车
✅ PASS - 验证购物车已清空
✅ PASS - 测试重复添加商品

通过率: 7/7 (100.0%)

🎉 所有测试通过！
```

## API 接口测试

### 1. 添加商品到购物车

```bash
curl -X POST http://localhost:8080/api/user/shoppingCart \
  -H "Content-Type: application/json" \
  -b "JSESSIONID=xxx" \
  -d '{
    "itemId": 1,
    "itemType": 1,
    "quantity": 2
  }'
```

### 2. 查询购物车列表

```bash
curl -X GET http://localhost:8080/api/user/shoppingCart \
  -b "JSESSIONID=xxx"
```

### 3. 清空购物车

```bash
curl -X DELETE http://localhost:8080/api/user/shoppingCart \
  -b "JSESSIONID=xxx"
```

## 测试要点

### 后端验证

- ✅ Session 认证检查
- ✅ 商品存在性验证
- ✅ 商品状态检查（只能添加在售商品）
- ✅ 重复商品数量累加
- ✅ 按创建时间倒序返回

### 前端验证

- ✅ 添加成功提示
- ✅ 购物车页面正常展示
- ✅ 清空购物车二次确认
- ✅ 路由跳转正常

### 边界测试

- ✅ 未登录访问 → 提示登录
- ✅ 添加不存在的商品 → 报错
- ✅ 添加已下架商品 → 报错
- ✅ 清空空购物车 → 正常
- ✅ 重复添加相同商品 → 数量累加
