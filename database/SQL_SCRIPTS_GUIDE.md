# 餐饮订单系统 - SQL脚本使用指南

## 📋 概述

本项目包含完整的SQL数据库初始化和测试脚本，用于快速部署和测试数据库结构和数据。

## 📁 脚本文件清单

### 1. **init.sql** - 数据库初始化脚本
- **功能**: 创建数据库和所有必要的表
- **包含内容**:
  - 创建`meal_order_system`数据库
  - 创建9个数据表：
    - `user` - 用户表
    - `category` - 分类表
    - `dish` - 菜品表
    - `setmeal` - 套餐表
    - `setmeal_dish` - 套餐菜品关系表
    - `address` - 地址表
    - `orders` - 订单表
    - `order_detail` - 订单详情表
    - `shopping_cart` - 购物车表
  - 创建多个索引以优化查询性能
  - 配置外键约束来保证数据完整性

### 2. **test_data.sql** - 测试数据脚本
- **功能**: 插入示例测试数据
- **包含内容**:
  - **用户数据**: 1个管理员 + 4个普通用户
  - **分类数据**: 6个菜品分类 + 2个套餐分类
  - **菜品数据**: 20道菜品，分别属于不同分类
  - **套餐数据**: 4个套餐组合
  - **套餐菜品**: 套餐与菜品的对应关系
  - **地址数据**: 每个用户的配送地址
  - **订单数据**: 5个示例订单（各种状态）
  - **订单详情**: 订单中的具体商品信息
  - **购物车数据**: 用户的购物车商品

### 3. **test_queries.sql** - SQL测试查询脚本
- **功能**: 执行23组测试查询，验证数据库完整性
- **测试内容**:

#### 第一部分：基础数据统计
- 用户总数统计（按类型和状态分类）
- 用户详细信息列表
- 分类统计（菜品分类vs套餐分类）
- 分类详细信息

#### 第二部分：菜品数据测试
- 菜品总数统计（库存、价格统计）
- 菜品分类统计（按分类统计菜品数和均价）
- 库存预警菜品查询（库存<30的菜品）
- 菜品详细信息列表

#### 第三部分：套餐数据测试
- 套餐总数统计
- 套餐及其菜品详情（显示套餐包含的菜品）

#### 第四部分：订单数据测试
- 订单总体统计（按状态统计）
- 订单详细信息
- 用户订单统计（消费统计）
- 最近7天订单查询

#### 第五部分：订单详情测试
- 订单详情汇总（商品种类和数量）
- 订单明细（每个订单的详细商品）

#### 第六部分：地址数据测试
- 用户地址统计
- 用户地址信息详情

#### 第七部分：购物车测试
- 购物车统计
- 用户购物车详情

#### 第八部分：数据质量检验
- 数据完整性检验（检查外键引用）
- 表结构信息统计

#### 第九部分：性能测试
- 索引检验

## 🚀 使用方法

### 方法1：使用BAT脚本（推荐 - Windows环境）

#### 步骤1：初始化数据库
```bash
双击: scripts\初始化数据库.bat
```

**脚本会：**
1. 检测MySQL是否安装
2. 提示输入MySQL root密码
3. 创建数据库并导入表结构（init.sql）
4. 导入测试数据（test_data.sql）
5. 显示默认账户信息

**默认账户信息：**
- 管理员: `admin` / `123456`
- 用户: `user001` ~ `user004` / `123456`

#### 步骤2：执行测试查询
```bash
双击: scripts\执行数据库测试.bat
```

**脚本会：**
1. 检测MySQL是否安装
2. 提示输入MySQL密码
3. 验证数据库是否存在（若不存在自动执行初始化）
4. 执行23个测试查询
5. 显示数据库统计和验证结果

### 方法2：手动执行（支持所有操作系统）

#### 使用命令行执行脚本：

```bash
# 1. 初始化数据库
mysql -u root -p < database/init.sql

# 2. 导入测试数据
mysql -u root -p meal_order_system < database/test_data.sql

# 3. 执行测试查询
mysql -u root -p meal_order_system < database/test_queries.sql
```

#### 或在MySQL客户端中执行：

```sql
-- 1. 执行初始化脚本
SOURCE /path/to/init.sql;

-- 2. 执行测试数据脚本
SOURCE /path/to/test_data.sql;

-- 3. 执行测试查询脚本
SOURCE /path/to/test_queries.sql;
```

### 方法3：在MySQL Workbench中执行

1. 打开MySQL Workbench
2. 连接到MySQL服务器
3. 文件 → 打开SQL脚本
4. 选择对应的`.sql`文件
5. 执行脚本（Ctrl+Shift+Enter）

## 📊 数据库架构

```
┌─────────────────────────────────────────────────────────┐
│          餐饮订单系统数据库架构                           │
└─────────────────────────────────────────────────────────┘

┌────────┐         ┌──────────┐         ┌────────┐
│  user  │         │ category │         │ setmeal│
│────────┤◄────────┤──────────┤────────►│────────│
│   id   │  user_id│   id     │ cat_id  │   id   │
└────────┘         └──────────┘         └────────┘
    ▲                   ▲                    ▲
    │                   │                    │
┌───┴───┐         ┌─────┴────┐         ┌────┴─────┐
│orders │         │  dish    │         │setmeal   │
│───────┤         │──────────┤         │_dish     │
│   id  │         │    id    │         │   id     │
│user_id│         └──────────┘         └──────────┘
└───┬───┘
    │
    │
┌───┴──────────┐
│order_detail  │
│──────────────┤
│     id       │
│  order_id    │
└──────────────┘

┌───────────┐         ┌──────────┐
│  address  │         │ shopping │
│────────┄──┤         │_cart     │
│   id      │         │──────────┤
│  user_id  │         │   id     │
└───────────┘         │ user_id  │
                      └──────────┘
```

## 🔍 核心表结构说明

### user（用户表）
| 字段 | 说明 |
|------|------|
| user_type | 1=普通用户，2=管理员 |
| status | 1=正常，0=禁用 |
| balance | 账户余额 |

### category（分类表）
| 字段 | 说明 |
|------|------|
| type | 1=菜品分类，2=套餐分类 |
| status | 1=启用，0=禁用 |

### dish（菜品表）
| 字段 | 说明 |
|------|------|
| status | 1=在售，0=停售 |
| is_deleted | 1=已删除，0=未删除（逻辑删除） |
| stock | 库存数量 |

### orders（订单表）
| 字段 | 说明 |
|------|------|
| status | 1=待确认，2=已确认，3=配送中，4=已完成，5=已取消 |
| pay_status | 0=未支付，1=已支付 |

## ✅ 验证清单

执行完脚本后，你可以验证：

- [ ] 数据库已创建
- [ ] 所有9个表都已创建
- [ ] 用户表有5条数据
- [ ] 分类表有8条数据（6个菜品分类 + 2个套餐分类）
- [ ] 菜品表有20条数据
- [ ] 套餐表有4条数据
- [ ] 订单表有5条数据
- [ ] 索引已创建
- [ ] 外键约束已生效
- [ ] 可以正常执行测试查询

## 🛠️ 常见问题

### Q1: MySQL错误："Access denied for user 'root'"
**A:** 
- 检查MySQL root密码是否正确
- 更新`application.yml`中的数据库密码配置
- 修改init.sql中的连接参数（如需要）

### Q2: 错误："Unknown database"
**A:**
- init.sql脚本未执行，需要先运行初始化脚本
- 或者数据库已被删除，需要重新执行init.sql

### Q3: 表已存在错误
**A:**
- 运行以下命令删除旧数据库：
```sql
DROP DATABASE meal_order_system;
```
- 然后重新执行init.sql

### Q4: 如何修改默认密码？
**A:**
- 编辑test_data.sql文件
- 修改INSERT INTO user语句中的password字段
- 重新执行test_data.sql

### Q5: 如何添加更多测试数据？
**A:**
- 编辑test_data.sql文件
- 添加新的INSERT语句
- 执行修改后的脚本

## 📝 配置文件关联

### application.yml 配置
脚本使用的数据库配置应与以下配置一致：
```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/meal_order_system
    username: root
    password: 123456
```

## 🔐 安全说明

⚠️ **注意：**
- 测试数据中的密码（123456）仅用于开发环境
- 生产环境应使用强密码
- 生产环境建议使用加密存储密码
- 不要在版本控制中提交包含真实密码的脚本

## 📞 技术支持

如果遇到问题，请：
1. 检查MySQL服务否正常运行
2. 验证MySQL版本（建议5.7+）
3. 确认文件路径正确
4. 查看MySQL错误日志
5. 参考常见问题部分

## ✨ 下一步

- 配置Java后端应用（backend）
- 启动前端应用（frontend-admin 和 frontend-user）
- 进行功能测试
- 根据需要修改数据或扩展功能
