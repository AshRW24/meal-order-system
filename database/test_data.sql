-- ============================================================
-- 餐饮订单系统测试数据初始化脚本
-- ============================================================

USE `meal_order_system`;

-- ============================================================
-- 1. 插入用户数据
-- ============================================================
DELETE FROM `user`;
ALTER TABLE `user` AUTO_INCREMENT = 1;

INSERT INTO `user`
(`username`, `password`, `phone`, `email`, `balance`, `status`, `user_type`, `create_time`, `update_time`)
VALUES
('admin', '123456', '13800138000', 'admin@example.com', 10000.00, 1, 2, NOW(), NOW()),
('user001', '123456', '13800138001', 'user001@example.com', 500.00, 1, 1, NOW(), NOW()),
('user002', '123456', '13800138002', 'user002@example.com', 1000.00, 1, 1, NOW(), NOW()),
('user003', '123456', '13800138003', 'user003@example.com', 300.00, 1, 1, NOW(), NOW()),
('user004', '123456', '13800138004', 'user004@example.com', 800.00, 1, 1, NOW(), NOW()),
('user005', '123456', '13800138005', 'user005@example.com', 1200.00, 1, 1, NOW(), NOW()),
('user006', '123456', '13800138006', 'user006@example.com', 200.00, 1, 1, NOW(), NOW()),
('user007', '123456', '13800138007', 'user007@example.com', 450.00, 1, 1, NOW(), NOW()),
('user008', '123456', '13800138008', 'user008@example.com', 0.00, 1, 1, NOW(), NOW()),
('user009', '123456', '13800138009', 'user009@example.com', 350.00, 0, 1, NOW(), NOW()), -- 账户禁用
('staff01', '123456', '13900139001', 'staff01@example.com', 800.00, 1, 2, NOW(), NOW()); -- 餐厅员工账户

-- ============================================================
-- 2. 插入分类数据 (1=菜品分类, 2=套餐分类)
-- ============================================================
DELETE FROM `category`;
ALTER TABLE `category` AUTO_INCREMENT = 1;

-- 菜品分类
INSERT INTO `category` 
(`name`, `type`, `sort`, `status`, `create_time`, `update_time`) 
VALUES
('川菜', 1, 1, 1, NOW(), NOW()),
('粤菜', 1, 2, 1, NOW(), NOW()),
('鲁菜', 1, 3, 1, NOW(), NOW()),
('淮扬菜', 1, 4, 1, NOW(), NOW()),
('浙菜', 1, 5, 1, NOW(), NOW()),
('素菜', 1, 6, 1, NOW(), NOW()),

-- 套餐分类
('商务套餐', 2, 1, 1, NOW(), NOW()),
('家庭套餐', 2, 2, 1, NOW(), NOW());

-- ============================================================
-- 3. 插入菜品数据
-- ============================================================
DELETE FROM `dish`;
ALTER TABLE `dish` AUTO_INCREMENT = 1;

INSERT INTO `dish` 
(`category_id`, `name`, `price`, `description`, `stock`, `status`, `is_deleted`, `create_time`, `update_time`) 
VALUES
-- 川菜 (category_id=1)
(1, '宫保鸡丁', 38.00, '精选鸡肉，配以花生、辣椒等食材，麻辣适口', 50, 1, 0, NOW(), NOW()),
(1, '水煮牛肉', 48.00, '新鲜牛肉，火锅味道，麻辣鲜香', 40, 1, 0, NOW(), NOW()),
(1, '辣子鸡', 42.00, '地道川菜，香辣可口，让人欲罢不能', 35, 1, 0, NOW(), NOW()),
(1, '回锅肉', 32.00, '豆豉香辣，荤素搭配，营养丰富', 45, 1, 0, NOW(), NOW()),
(1, '鱼香肉丝', 36.00, '融合了鱼香、肉质的完美结合', 50, 1, 0, NOW(), NOW()),

-- 粤菜 (category_id=2)
(2, '清蒸鱼', 48.00, '新鲜鱼类，采用清蒸烹饪，保留原汁原味', 30, 1, 0, NOW(), NOW()),
(2, '蚝油牛肉', 44.00, '用蚝油独特的香味，配以新鲜牛肉', 40, 1, 0, NOW(), NOW()),
(2, '白切鸡', 38.00, '传统粤菜，鸡肉嫩滑，入口即化', 25, 1, 0, NOW(), NOW()),
(2, '烧鹅', 56.00, '金黄酥脆的烧鹅，风味独特', 20, 1, 0, NOW(), NOW()),

-- 鲁菜 (category_id=3)
(3, '德州扒鸡', 46.00, '鲁菜代表作，色香味俱全', 30, 1, 0, NOW(), NOW()),
(3, '葱爆海参', 58.00, '高档食材，营养丰富，味道鲜美', 25, 1, 0, NOW(), NOW()),
(3, '红烧海螺', 42.00, '新鲜海螺，红烧入味，鲜香十足', 35, 1, 0, NOW(), NOW()),

-- 淮扬菜 (category_id=4)
(4, '狮子头', 40.00, '淮扬菜精品，肉质鲜嫩多汁', 40, 1, 0, NOW(), NOW()),
(4, '大煮干丝', 28.00, '清汤底，豆制品香味浓郁', 50, 1, 0, NOW(), NOW()),

-- 浙菜 (category_id=5)
(5, '西湖醋鱼', 52.00, '浙菜代表，酸酸的西湖醋配以新鲜鱼肉', 30, 1, 0, NOW(), NOW()),
(5, '茶香鸡', 44.00, '用茶叶烹制，回甘的茶香融入鸡肉', 35, 1, 0, NOW(), NOW()),

-- 素菜 (category_id=6)
(6, '宫保豆腐', 22.00, '豆腐爽滑，配以花生和辣椒，素食佳品', 60, 1, 0, NOW(), NOW()),
(6, '炒时蔬', 18.00, '时令蔬菜，营养均衡，健康首选', 70, 1, 0, NOW(), NOW());

-- ============================================================
-- 4. 插入套餐数据
-- ============================================================
DELETE FROM `setmeal`;
ALTER TABLE `setmeal` AUTO_INCREMENT = 1;

INSERT INTO `setmeal` 
(`category_id`, `name`, `price`, `description`, `status`, `is_deleted`, `create_time`, `update_time`) 
VALUES
(7, '商务午餐精选', 68.00, '包含：宫保鸡丁、清蒸鱼、炒时蔬、米饭', 1, 0, NOW(), NOW()),
(7, '高级商务套餐', 88.00, '包含：水煮牛肉、烧鹅、大煮干丝、米饭', 1, 0, NOW(), NOW()),
(8, '家庭聚餐套餐', 128.00, '包含：回锅肉、清蒸鱼、西湖醋鱼、时蔬、米饭', 1, 0, NOW(), NOW()),
(8, '亲子餐套餐', 78.00, '包含：宫保鸡丁、白切鸡、炒时蔬、果汁', 1, 0, NOW(), NOW());

-- ============================================================
-- 5. 插入套餐菜品关系数据
-- ============================================================
DELETE FROM `setmeal_dish`;
ALTER TABLE `setmeal_dish` AUTO_INCREMENT = 1;

INSERT INTO `setmeal_dish` 
(`setmeal_id`, `dish_id`, `copies`, `create_time`) 
VALUES
-- 商务午餐精选 (setmeal_id=1)
(1, 1, 1, NOW()),   -- 宫保鸡丁
(1, 6, 1, NOW()),   -- 清蒸鱼
(1, 20, 1, NOW()),  -- 炒时蔬

-- 高级商务套餐 (setmeal_id=2)
(2, 2, 1, NOW()),   -- 水煮牛肉
(2, 8, 1, NOW()),   -- 烧鹅
(2, 14, 1, NOW()),  -- 大煮干丝

-- 家庭聚餐套餐 (setmeal_id=3)
(3, 4, 1, NOW()),   -- 回锅肉
(3, 6, 1, NOW()),   -- 清蒸鱼
(3, 15, 1, NOW()),  -- 西湖醋鱼
(3, 20, 1, NOW()),  -- 炒时蔬

-- 亲子餐套餐 (setmeal_id=4)
(4, 1, 1, NOW()),   -- 宫保鸡丁
(4, 8, 1, NOW()),   -- 白切鸡
(4, 20, 1, NOW()); -- 炒时蔬

-- ============================================================
-- 6. 插入地址数据
-- ============================================================
DELETE FROM `address`;
ALTER TABLE `address` AUTO_INCREMENT = 1;

INSERT INTO `address` 
(`user_id`, `consignee`, `phone`, `province_code`, `province_name`, `city_code`, `city_name`, `district_code`, `district_name`, `detail`, `tag`, `is_default`, `create_time`, `update_time`) 
VALUES
(2, '张三', '13800138001', '110000', '北京市', '110100', '北京市', '110105', '朝阳区', '建国路某某大厦2018号室', '公司', 1, NOW(), NOW()),
(2, '张三', '13800138001', '110000', '北京市', '110100', '北京市', '110102', '东城区', '和平里某街道123号', '家', 0, NOW(), NOW()),
(3, '李四', '13800138002', '310000', '浙江省', '310100', '杭州市', '310105', '滨江区', '闻涛路某商业中心F座', '家', 1, NOW(), NOW()),
(4, '王五', '13800138003', '440000', '广东省', '440100', '广州市', '440105', '天河区', '中山大道某写字楼', '办公', 1, NOW(), NOW()),
(5, '赵六', '13800138004', '210000', '辽宁省', '210100', '沈阳市', '210102', '和平区', '文化路某小区', '家', 1, NOW(), NOW());

-- ============================================================
-- 7. 插入订单数据
-- ============================================================
DELETE FROM `orders`;
ALTER TABLE `orders` AUTO_INCREMENT = 1;

INSERT INTO `orders`
(`order_number`, `user_id`, `address_id`, `amount`, `status`, `pay_status`, `consignee`, `phone`, `address`, `order_time`, `pay_time`, `complete_time`)
VALUES
-- 已完成订单
('ORD20250001', 2, 1, 106.00, 4, 1, '张三', '13800138001', '北京市朝阳区建国路某某大厦2018号室', '2025-12-01 12:30:00', '2025-12-01 12:35:00', '2025-12-01 13:45:00'),
('ORD20250002', 2, 1, 88.00, 4, 1, '张三', '13800138001', '北京市朝阳区建国路某某大厦2018号室', '2025-12-02 18:20:00', '2025-12-02 18:25:00', '2025-12-02 19:15:00'),
('ORD20250003', 3, 3, 128.00, 4, 1, '李四', '13800138002', '浙江省杭州市滨江区闻涛路某商业中心F座', '2025-12-03 11:50:00', '2025-12-03 12:00:00', '2025-12-03 13:25:00'),
('ORD20250004', 4, 4, 68.00, 4, 1, '王五', '13800138003', '广东省广州市天河区中山大道某写字楼', '2025-12-04 12:15:00', '2025-12-04 12:20:00', '2025-12-04 13:10:00'),
('ORD20250005', 5, 5, 78.00, 4, 1, '赵六', '13800138004', '辽宁省沈阳市和平区文化路某小区', '2025-12-05 19:30:00', '2025-12-05 19:35:00', '2025-12-05 20:45:00'),
('ORD20250006', 6, NULL, 42.00, 4, 1, '钱七', '13800138005', '', '2025-12-04 08:30:00', '2025-12-04 08:35:00', '2025-12-04 08:55:00'),

-- 配送中订单
('ORD20250007', 7, NULL, 152.00, 3, 1, '孙八', '13800138006', '', '2025-12-05 10:15:00', '2025-12-05 10:20:00', NULL),
('ORD20250008', 3, 3, 94.00, 3, 1, '李四', '13800138002', '浙江省杭州市滨江区闻涛路某商业中心F座', '2025-12-05 14:30:00', '2025-12-05 14:35:00', NULL),

-- 已确认订单
('ORD20250009', 8, NULL, 76.00, 2, 1, '周九', '13800138007', '', '2025-12-05 15:45:00', '2025-12-05 15:50:00', NULL),

-- 待确认订单
('ORD20250010', 9, NULL, 158.00, 1, 0, '吴十', '13800138008', '', '2025-12-05 16:20:00', NULL, NULL),

-- 已取消订单
('ORD20250011', 4, 4, 48.00, 5, 0, '王五', '13800138003', '广东省广州市天河区中山大道某写字楼', '2025-11-28 09:00:00', NULL, NULL),
('ORD20250012', 5, 5, 86.00, 5, 0, '赵六', '13800138004', '辽宁省沈阳市和平区文化路某小区', '2025-11-29 18:30:00', NULL, NULL);

-- 添加更多历史订单数据以支持趋势分析

-- ============================================================
-- 8. 插入订单详情数据
-- ============================================================
DELETE FROM `order_detail`;
ALTER TABLE `order_detail` AUTO_INCREMENT = 1;

INSERT INTO `order_detail` 
(`order_id`, `dish_id`, `dish_name`, `quantity`, `price`, `amount`, `create_time`) 
VALUES
-- ORD20250001 订单详情
(1, 1, '宫保鸡丁', 1, 38.00, 38.00, NOW()),
(1, 6, '清蒸鱼', 1, 48.00, 48.00, NOW()),
(1, NULL, '炒时蔬', 1, 18.00, 18.00, NOW()),
(1, NULL, '米饭', 2, 1.00, 2.00, NOW()),

-- ORD20250002 订单详情
(2, 2, '水煮牛肉', 1, 48.00, 48.00, NOW()),
(2, NULL, '大煮干丝', 1, 28.00, 28.00, NOW()),
(2, NULL, '米饭', 1, 1.00, 1.00, NOW()),
(2, NULL, '小菜', 1, 11.00, 11.00, NOW()),

-- ORD20250003 订单详情
(3, 4, '回锅肉', 1, 32.00, 32.00, NOW()),
(3, 6, '清蒸鱼', 1, 48.00, 48.00, NOW()),
(3, 15, '西湖醋鱼', 1, 52.00, 52.00, NOW()),
(3, NULL, '炒时蔬', 1, 18.00, 18.00, NOW()),
(3, NULL, '米饭', 2, 1.00, 2.00, NOW()),
(3, NULL, '汤', 1, 8.00, 8.00, NOW()),

-- ORD20250004 订单详情
(4, 1, '宫保鸡丁', 1, 38.00, 38.00, NOW()),
(4, 6, '清蒸鱼', 1, 48.00, 48.00, NOW()),
(4, NULL, '米饭', 2, 1.00, 2.00, NOW()),

-- ORD20250005 订单详情
(5, 1, '宫保鸡丁', 1, 38.00, 38.00, NOW()),
(5, 8, '白切鸡', 1, 38.00, 38.00, NOW()),
(5, NULL, '炒时蔬', 1, 18.00, 18.00, NOW()),
(5, NULL, '橙汁', 1, 12.00, 12.00, NOW());

-- ============================================================
-- 9. 插入购物车数据 (示例：user001的购物车)
-- ============================================================
DELETE FROM `shopping_cart`;
ALTER TABLE `shopping_cart` AUTO_INCREMENT = 1;

INSERT INTO `shopping_cart` 
(`user_id`, `dish_id`, `dish_name`, `price`, `quantity`, `amount`, `create_time`, `update_time`) 
VALUES
(2, 1, '宫保鸡丁', 38.00, 2, 76.00, NOW(), NOW()),
(2, 2, '水煮牛肉', 48.00, 1, 48.00, NOW(), NOW()),
(3, 6, '清蒸鱼', 48.00, 1, 48.00, NOW(), NOW()),
(3, 15, '西湖醋鱼', 52.00, 1, 52.00, NOW(), NOW());

-- ============================================================
-- 后续为SQL测试查询语句
-- ============================================================

-- ============================================================
-- 测试查询：获取所有用户
-- ============================================================
-- SELECT * FROM `user`;

-- ============================================================
-- 测试查询：获取所有分类及其菜品数量
-- ============================================================
-- SELECT c.id, c.name, c.type, COUNT(DISTINCT d.id) as dish_count
-- FROM `category` c
-- LEFT JOIN `dish` d ON c.id = d.category_id AND d.is_deleted = 0
-- WHERE c.status = 1
-- GROUP BY c.id, c.name, c.type;

-- ============================================================
-- 测试查询：获取用户订单统计
-- ============================================================
-- SELECT u.id, u.username, COUNT(o.id) as order_count, SUM(o.amount) as total_amount
-- FROM `user` u
-- LEFT JOIN `orders` o ON u.id = o.user_id
-- WHERE u.user_type = 1
-- GROUP BY u.id, u.username;

-- ============================================================
-- 测试查询：获取订单详情信息
-- ============================================================
-- SELECT o.order_number, o.amount, o.status, 
--        GROUP_CONCAT(od.dish_name) as items,
--        SUM(od.quantity) as total_quantity
-- FROM `orders` o
-- LEFT JOIN `order_detail` od ON o.id = od.order_id
-- WHERE o.order_time >= DATE_SUB(NOW(), INTERVAL 7 DAY)
-- GROUP BY o.id, o.order_number, o.amount, o.status;

-- ============================================================
-- 测试查询：获取库存预警的菜品
-- ============================================================
-- SELECT id, name, category_id, price, stock
-- FROM `dish`
-- WHERE stock < 30 AND status = 1 AND is_deleted = 0
-- ORDER BY stock ASC;

-- ============================================================
-- 测试查询：套餐及其菜品明细
-- ============================================================
-- SELECT s.id, s.name, s.price,
--        GROUP_CONCAT(d.name ORDER BY d.name SEPARATOR ', ') as dishes,
--        COUNT(sd.id) as dish_count
-- FROM `setmeal` s
-- LEFT JOIN `setmeal_dish` sd ON s.id = sd.setmeal_id
-- LEFT JOIN `dish` d ON sd.dish_id = d.id
-- WHERE s.status = 1 AND s.is_deleted = 0
-- GROUP BY s.id, s.name, s.price;

-- ============================================================
-- 测试脚本执行完成
-- ============================================================

COMMIT;
